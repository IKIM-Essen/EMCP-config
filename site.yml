#!/usr/bin/env ansible-playbook

# setup rancher on k1-20

---
- hosts: k8s
  become: yes
  ignore_errors: yes
  remote_user: ubuntu
  gather_facts: true
  vars:
    ansible_ssh_private_key_file: files/ikimk8s_rsa
  environment:
      http_proxy: http://***REMOVED***:3128
      https_proxy: http://***REMOVED***:3128
      KUBECONFIG: kube_config_ikimk8s.yaml
      no_proxy: "127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16,cattle-system.svc"
  roles:
    - update
    - docker
    - rancher
    - security


- hosts: infra
  become: yes
  ignore_errors: yes
  remote_user: ubuntu
  gather_facts: true
  environment:
      http_proxy: http://***REMOVED***:3128
      https_proxy: http://***REMOVED***:3128
  roles:
    - docker
    - security

- hosts: server
  become: yes
  ignore_errors: yes
  remote_user: ubuntu
  gather_facts: true
  environment:
      http_proxy: http://***REMOVED***:3128
      https_proxy: http://***REMOVED***:3128
  roles:
    - security


- hosts: cluster
  become: yes
  ignore_errors: yes
  remote_user: ubuntu
  gather_facts: true
  environment:
      http_proxy: http://***REMOVED***:3128
      https_proxy: http://***REMOVED***:3128
  roles:
    - update
    - c-nodes
    - nfs-client
    - singularity
    - security


- hosts: gpucluster
  become: yes
  ignore_errors: yes
  remote_user: ubuntu
  gather_facts: true
  environment:
      http_proxy: http://***REMOVED***:3128
      https_proxy: http://***REMOVED***:3128
  roles:
    - update
    - nfs-client
    - g-nodes
    - docker
    - security
    - role: nvidia
      vars: 
        - nvidia_driver_ubuntu_branch: 460


- hosts: ipaserver
  become: yes
  ignore_errors: yes
  remote_user: ubuntu
  gather_facts: true
  environment:
      http_proxy: http://***REMOVED***:3128
      https_proxy: http://***REMOVED***:3128
  roles:
    - ipa-server

