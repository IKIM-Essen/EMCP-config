---
# The sequence of the slurm daemon handlers is deliberate.
# To preserve the state of running jobs and the accounting history,
# the following conditions should hold:
#   - The controller must be stopped first.
#   - The database must be started first.
#   - The controller must be started last.
- name: stop slurmctld
  become: true
  community.general.supervisorctl:
    name: slurmctld
    state: stopped

- name: restart slurmdbd
  become: true
  ignore_errors: true
  community.general.supervisorctl:
    name: slurmdbd
    state: restarted

- name: restart slurmd
  become: true
  ansible.builtin.systemd:
    name: slurmd
    state: restarted

- name: start slurmctld
  become: true
  ignore_errors: true
  community.general.supervisorctl:
    name: slurmctld
    state: started

- name: restart munge systemd
  become: true
  ansible.builtin.systemd:
    name: munge
    state: restarted

- name: restart munge supervisord
  become: true
  community.general.supervisorctl:
    name: munged
    state: restarted
