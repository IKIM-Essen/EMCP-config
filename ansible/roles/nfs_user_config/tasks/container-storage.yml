---

- name: Create .config/containers if it doesn't exist
  ansible.builtin.file:
    path: "{{ nfs_user_config_item.path }}/.config/containers"
    owner: "{{ nfs_user_config_item.uid }}"
    group: "{{ nfs_user_config_item.gid }}"
    mode: 0755
    state: directory
  loop: "{{ home_directories.files }}"
  loop_control:
    loop_var: nfs_user_config_item
  become: true

- name: Copy the rootless container storage configuration
  ansible.builtin.template:
    src: containers-storage.conf
    dest: "{{ nfs_user_config_item.path }}/.config/containers/storage.conf"
    owner: "{{ nfs_user_config_item.uid }}"
    group: "{{ nfs_user_config_item.gid }}"
    mode: 0644
    force: true
  loop: "{{ home_directories.files }}"
  loop_control:
    loop_var: nfs_user_config_item
  become: true
