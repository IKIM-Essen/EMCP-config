---

- name: ensure the presence of the .docker directory
  ansible.builtin.file:
    path: "{{ nfs_user_config_item.path }}/.docker"
    owner: "{{ nfs_user_config_item.uid }}"
    group: "{{ nfs_user_config_item.gid }}"
    mode: 0755
    state: directory
  loop: "{{ home_directories.files }}"
  loop_control:
    loop_var: nfs_user_config_item
  become: true

- name: ensure the users' docker proxy settings are correct
  ansible.builtin.template:
    src: docker-config.json.j2
    dest: "{{ nfs_user_config_item.path }}/.docker/config.json"
    owner: "{{ nfs_user_config_item.uid }}"
    group: "{{ nfs_user_config_item.gid }}"
    mode: 0644
    force: true
  loop: "{{ home_directories.files }}"
  loop_control:
    loop_var: nfs_user_config_item
  become: true
