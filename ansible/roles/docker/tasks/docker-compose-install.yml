---
# The Ubuntu package of Docker Compose cannot be used as it pulls outdated
# depdendencies which clash with the Docker Engine installation
- name: Download the Docker Compose executable
  ansible.builtin.get_url:
    url: "{{ docker_compose_url }}"
    dest: "{{ docker_cli_plugins_dir }}/docker-compose"
    owner: root
    group: root
    mode: 0755
    checksum: "sha256:{{ lookup('url', docker_compose_digest_url) | regex_search('[0-9a-f]{64}') }}"
  environment: "{{ proxy_env | default({}) }}"

- name: Test the Docker Compose installation
  ansible.builtin.command: docker compose version
  changed_when: false
