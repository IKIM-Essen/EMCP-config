- name: install cachefilesd
  ansible.builtin.apt:
    name: cachefilesd
    state: present

- name: Make sure the cachefilesd service is running
  ansible.builtin.systemd:
    name: cachefilesd
    enabled: true
    state: started

- name: Configure the cache directory
  ansible.builtin.lineinfile:
    path: /etc/cachefilesd.conf
    regexp: '^dir '
    line: 'dir {{ cachefilesd_dir }}'
    owner: root
    group: root
    mode: 0644
  when: cachefilesd_dir
  notify: restart cachefilesd

- name: Enable cachefilesd
  ansible.builtin.lineinfile:
    path: /etc/default/cachefilesd
    regexp: '^#?RUN='
    line: 'RUN=yes'
    owner: root
    group: root
    mode: 0644
  notify: restart cachefilesd
