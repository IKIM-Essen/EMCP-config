
- name: install dependencies
  ansible.builtin.apt:
    name: python3-docker
    state: present
  become: true

- name: write nginx config
  ansible.builtin.template:
    src: nginx.conf.j2
    dest: /etc/nginx.conf
    mode: 0755
    owner: root
    group: root
  become: true
  notify: restart rancher-lb docker container

- name: execute nginx docker image
  community.docker.docker_container:
    name: rancher-lb
    image: nginx:stable
    state: started
    volumes:
      - /etc/nginx.conf:/etc/nginx/nginx.conf:ro
    restart_policy: unless-stopped
    detach: true
    published_ports:
      - 80:80
      - 443:443
    container_default_behavior: no_defaults
  become: true
