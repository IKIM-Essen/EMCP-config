name: Clean up old container images

on:
  pull_request:
  schedule:
    # Every day at 4:15 am
    - cron: 15 4 * * *

jobs:
  delete-images:
    runs-on: ubuntu-latest
    permissions:
      packages: write

    steps:
      - name: Delete images older than a month built built by pull requests
        uses: snok/container-retention-policy@v1
        with:
          image-names: "*"
          filter-tags: pr-*
          cut-off: One month ago UTC
          account-type: org
          org-name: ${{ github.repository_owner }}
          token: ${{ secrets.GITHUB_TOKEN }}
